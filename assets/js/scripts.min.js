jQuery(function(d){var r={popup_reveal:"",$popup:d("#ndfw-popup"),$popup_success:d("#ndfw-popup-success"),init:function(){this.popup_reveal=ndfw_settings.popup_reveal,d(document.body).bind("init_popup",this.init_popup),d(document.body).bind("show_popup",this.show_popup),d(document.body).bind("show_popup_preview",this.show_popup_preview),d(document.body).bind("close_popup",this.close_popup),d(document.body).bind("close_popup_preview",this.close_popup_preview),d(document.body).bind("success_popup",this.show_popup_success),this.$popup.find("#ndfw-popup-form-close").on("click",this.close_popup),this.$popup.find("#ndfw-popup-form").on("submit",this.new_subscriber),this.$popup.find("#ndfw-popup-form-submit").on("click",this.new_subscriber),this.$popup_success.find("#ndfw-popup-shop").on("click",this.shop),jQuery(window).load(function(){d(document.body).trigger("init_popup")})},update_impressions:function(){var p={action:"ndfw_update_popup_impressions",security:ndfw_popup_form.update_popup_impressions_nonce};return d.post(ndfw_popup_form.ajax_url,p),!1},new_subscriber:function(p){p.preventDefault();var n=r.$popup.find(".ndfw-popup-wrapper"),t=r.$popup.find("#ndfw-popup-form"),e={action:"ndfw_check_subscriber",form_data:t.serialize(),security:ndfw_popup_form.check_subscriber_nonce};return n.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),d.post(ndfw_popup_form.ajax_url,e,function(p){var e=JSON.parse(p);if(t.find(".ndfw-popup-message").remove(),n.unblock(),"success"!=e.status){var o='<div class="ndfw-popup-message"><div class="woocommerce-error">'+e.error_message+"</div></div>";return t.find(".ndfw-popup-form").before(o),!1}r.add_subscriber()}),!1},add_subscriber:function(){var n=r.$popup.find(".ndfw-popup-wrapper"),t=r.$popup.find("#ndfw-popup-form"),e=r.$popup.find(".ndfw-popup-consent");if(e.length){var p=r.$popup.find("#ndfw-popup-consent-info").prop("checked"),o=r.$popup.find("#ndfw-popup-consent-marketing").prop("checked");if(!p&&!o&&!e.hasClass("ndfw-popup-consent-visible")){t.find(".ndfw-popup-headline").hide(),t.find(".ndfw-popup-body").hide(),t.find(".ndfw-popup-form").hide(),t.find(".ndfw-popup-note").hide(),r.$popup.find("#ndfw-popup-consent-info").prop("required",!0),r.$popup.find("#ndfw-popup-consent-marketing").prop("required",!0);anime({targets:"#ndfw-popup .ndfw-popup-consent",height:{value:"100%",duration:400,easing:"easeOutQuad"},opacity:{value:[0,1],duration:400,easing:"easeOutQuad"},begin:function(p){e.addClass("ndfw-popup-consent-visible")}});return!1}}var u={action:"ndfw_add_subscriber",form_data:t.serialize(),security:ndfw_popup_form.add_subscriber_nonce};return n.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),d.post(ndfw_popup_form.ajax_url,u,function(p){var e=JSON.parse(p);if("success"==e.status)d(document.body).trigger("success_popup");else{t.find(".ndfw-popup-message").remove();var o='<div class="ndfw-popup-message"><div class="woocommerce-error">'+e.error_message+"</div></div>";t.find(".ndfw-popup-form").before(o)}n.unblock()}),!1},close_popup:function(p){return p.preventDefault(),r.$popup.addClass("ndfw-popup-hidden"),r.$popup.remove(),document.cookie=encodeURIComponent("_ndfw_popup_dismissed")+"="+encodeURIComponent("true")+"; path=/",!1},close_popup_preview:function(p){p.preventDefault();anime({targets:"#ndfw-popup",scale:{value:[1,1.1],duration:0,easing:"easeOutQuad"},opacity:{value:[1,0],duration:100,easing:"easeOutQuad"},begin:function(p){r.$popup.css("z-index",-1),r.$popup.removeClass("ndfw-popup-visible")}});return!1},addEvent:function(p,e,o){p.addEventListener?p.addEventListener(e,o,!1):p.attachEvent&&p.attachEvent("on"+e,o)},init_popup:function(){return!!r.$popup.length&&(!r.$popup.hasClass("ndfw-popup-preview")&&(window.Scrollbar.init(document.querySelector(".ndfw-popup-content")),r.init_timer(),void(""==r.popup_reveal?d(document.body).trigger("show_popup"):"after_5"==r.popup_reveal?setTimeout(function(){d(document.body).trigger("show_popup")},5e3):"after_20"==r.popup_reveal?setTimeout(function(){d(document.body).trigger("show_popup")},2e4):"on_exit"==r.popup_reveal?r.addEvent(document,"mouseout",function(p){if("input"!=(p=p||window.event).target.tagName.toLowerCase()){var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0);if(!(p.clientX>=e-50))if(!(50<=p.clientY))p.relatedTarget||p.toElement||d(document.body).trigger("show_popup")}}.bind(this)):"scroll_mid"==r.popup_reveal?jQuery(window).scroll(function(){.5<=d(window).scrollTop()/(d(document).innerHeight()-d(window).height())&&d(document.body).trigger("show_popup")}):"scroll_bottom"==r.popup_reveal&&jQuery(window).scroll(function(){.95<d(window).scrollTop()/(d(document).innerHeight()-d(window).height())&&d(document.body).trigger("show_popup")}))))},show_popup:function(){if(r.$popup.hasClass("ndfw-popup-visible")||r.$popup.hasClass("ndfw-popup-hidden"))return!1;anime({targets:"#ndfw-popup",scale:{value:[1.1,1],duration:400,easing:"easeOutQuad"},opacity:{value:[0,1],duration:400,easing:"easeOutQuad"},begin:function(p){r.$popup.css("z-index",9999),r.$popup.addClass("ndfw-popup-visible")},complete:function(p){r.update_impressions();var e=r.$popup.find(".ndfw-popup-content").height(),o=r.$popup_success.find(".ndfw-popup-content").height();if(o<e){var n=(e-o)/2;r.$popup_success.find(".ndfw-popup-content-wrapper").css("margin-top",n+"px").css("margin-bottom",n+"px")}}})},show_popup_preview:function(){if(r.$popup.hasClass("ndfw-popup-visible")||r.$popup.hasClass("ndfw-popup-hidden"))return!1;anime({targets:"#ndfw-popup",scale:{value:[1.1,1],duration:400,easing:"easeOutQuad"},opacity:{value:[0,1],duration:400,easing:"easeOutQuad"},begin:function(p){r.$popup.css("z-index",9999),r.$popup.addClass("ndfw-popup-visible")},complete:function(p){var e=r.$popup.find(".ndfw-popup-content").height(),o=r.$popup_success.find(".ndfw-popup-content").height();if(o<e){var n=(e-o)/2;r.$popup_success.find(".ndfw-popup-content-wrapper").css("margin-top",n+"px").css("margin-bottom",n+"px")}}})},show_popup_success:function(){event.preventDefault(),r.$popup.remove(),document.cookie=encodeURIComponent("_ndfw_discount_activated")+"="+encodeURIComponent("true")+"; path=/";anime({targets:"#ndfw-popup-success",scale:{value:[1.1,1],duration:400,easing:"easeOutQuad"},opacity:{value:[0,1],duration:400,easing:"easeOutQuad"},begin:function(p){r.$popup_success.css("z-index",9999)}});return!1},shop:function(){r.$popup_success.remove()},init_timer:function(){var p=this.$popup.find("#ndfw-popup-timer p"),e=p.attr("data-start"),o=p.attr("data-value");o--,p.attr("data-value",o),document.cookie=encodeURIComponent("_ndfw_timer_start")+"="+encodeURIComponent(e)+"; path=/",document.cookie=encodeURIComponent("_ndfw_timer_value")+"="+encodeURIComponent(o)+"; path=/";var n=[Math.floor(o/60/60/24),Math.floor(o/60/60)%24,Math.floor(o/60)%60,o%60],t=(n[0]<10?"0":"")+n[0],u=(n[1]<10?"0":"")+n[1],i=(n[2]<10?"0":"")+n[2],s=(n[3]<10?"0":"")+n[3];if(p.find('[data-index="0"]').text(t),p.find('[data-index="1"]').text(u),p.find('[data-index="2"]').text(i),p.find('[data-index="3"]').text(s),0===o)return"hide"===ndfw_settings.timer_action?d(document.body).trigger("close_popup"):"reset"===ndfw_settings.timer_action&&(r.$popup.addClass("ndfw-popup-hidden"),r.$popup.remove()),!1;setTimeout(function(){r.init_timer()},1e3)}};r.init()});